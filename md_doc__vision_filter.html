<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GT RoboCup SSL: Vision Filter</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rj_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GT RoboCup SSL
   </div>
   <div id="projectbrief">Soccer software, robot firmware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_doc__vision_filter.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Vision Filter </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Based on a mixture of the Mannheim Tiger's vision filter from their <a href="https://gitlab.tigers-mannheim.de/open-source/AutoReferee">auto-ref</a> and something known as the <a href="https://dainamite.github.io/public/publication/qian_master_thesis.pdf">Multi-Hypothesis Extended Kalman Filter (MHEKF)</a> found in a paper from the RoboCup SPL league team DAInamite. The overall goal of this module is to convert the raw vision packet data from SSL-Vision and creates a good estimate of the true robot and ball positions.</p>
<p>The overall setup is shown in the image below. Vision data is fed into the world object. This world object splits up the vision data by camera ID and feeds it into each corresponding camera object. The camera objects then apply the vision data as measurements to individual kalman filters corresponding to balls and robots. The world object then combines the best kalman filter from each camera for each individual robot and ball.</p>
<div class="image">
<img src="https://i.imgur.com/BjU5TU8.png" width="800"/>
</div>
<h2>SSL-Vision Format</h2>
<p>Each individual camera sends a frame packet. Each frame packet contains one or more balls and one or more robots depending on what is in the camera view. Consequently, the frames are not sent at a consistent rate and you may get more than one camera frame at a time depending on how things work out. A ball may show up on multiple cameras so you may get a measurement in multiple camera frames. Sometimes extra balls and robots will show up for a frame or two due to noise.</p>
<h2>Kalman Filter</h2>
<p>A kalman filter is a statistical approach to estimating positions/velocities (etc) of different objects. In this specific case, the model assumes constant velocity that integrates down to position. This is for each independent axis (X, Y and in the robot's case, heading). The filter keeps track of the X pos/vel, Y pos/vel (and heading pos/vel) as well as how confident it is in each estimate.</p>
<p>Every iteration the filter either predicts or predicts and updates. When it predicts, it predicts current positions and velocities given what the position and velocities were last frame. When it predicts and updates, it again predicts it's current positions and velocities, but then compares that to the measurements it receives and updates it's position and velocity. If we are really confident in our current estimates, it doesn't really take into account the measurement. On the flip side, if we aren't confident, we almost completely use the measurement as the truth. Additionally, the confidence of our estimate steadily decreases each time we predict without an update.</p>
<h2>Camera</h2>
<p>The camera object receives all the measurements for a specific camera ID. The camera then chooses how to apply these measurements to the kalman filters objects it contains. There are two different algorithms to match the measurements to kalman filters, the first is the average kalman filter and the other is the multi-hypothesis kalman filter.</p>
<p>The average kalman filter averages all the measurements corresponding to that specific object and then applies it to the single kalman filter for that object. For example, the ball object will average the positions of all the measurements from the camera frame and use that as the measurement for the single ball kalman filter.</p>
<p>The multi-hypothesis kalman filter takes all measurements that are within a specific distance of the object and averages those together. This average is then used as the measurement for that specific kalman filter. Any that are not "claimed" by a kalman filter are used as the initial position for new kalman filters. There can therefor be multiple kalman filters for a specific object like a ball.</p>
<p>Additionally, we use a simple geometric model to predict how the ball velocity will change when it bounces off of robots to improve the estimation.</p>
<h2>World</h2>
<p>The world object takes the list of packets from SSL-Vision and splits it into data for each camera. It then sends the data down to the cameras for processing. Once that processing is done, the world object then takes the best kalman filter for each object from each frame. The set of kalman filters corresponding to a single object from all the cameras are merged together based on their confidence. This set of merged objects are referred to with the World* qualifier and are our best estimates of the pos/vel of the objects.</p>
<h2>VisionFilter</h2>
<p>The vision filter module converts the protobuf format from SSL-Vision to a custom format with the Camera* qualifier. This removes all the extra data that isn't needed and makes it easier to edit code. Additionally, there are operations to push the data from the filter into the system state object.</p>
<p>The vision filter module is threaded to run at a very specific timing matching the kalman filter predict/update rate. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Jul 18 2019 12:00:33 for GT RoboCup SSL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
